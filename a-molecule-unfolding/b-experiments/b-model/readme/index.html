<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.79.1"><meta name=description content><link rel="shortcut icon" href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/favicon.ico type=image/x-icon><title>Build The Model :: Quantum Computing Solution</title><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/nucleus.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/fontawesome-all.min.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/hybrid.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/featherlight.min.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/perfect-scrollbar.min.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/auto-complete.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/atom-one-dark-reasonable.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/theme.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/tabs.css?1633697294 rel=stylesheet><link href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/css/hugo-theme.css?1633697294 rel=stylesheet><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/jquery-3.3.1.min.js?1633697294></script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><script type=text/x-mathjax-config>
      MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} })
    </script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/b-model/readme/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/logo.png alt="AWS Logo" width=44% height=44%></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/lunr.min.js?1633697294></script><script type=text/javascript src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/auto-complete.js?1633697294></script><script type=text/javascript>var baseurl="https:\/\/gcr-solutions.github.io\/quantum-computing-for-life-science-workshop\/";</script><script type=text/javascript src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/search.js?1633697294></script></div><div class=highlightable><ul class=topics><li data-nav-id=/a-molecule-unfolding/ title="Molecule Unfolding" class="dd-item
parent"><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/>Molecule Unfolding</a><ul><li data-nav-id=/a-molecule-unfolding/0-prerequisite/ title=Prerequisite class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/0-prerequisite/>Prerequisite</a></li><li data-nav-id=/a-molecule-unfolding/a-background/ title=Background class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/a-background/>Background</a></li><li data-nav-id=/a-molecule-unfolding/b-experiments/ title=Experiments class="dd-item
parent"><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/>Experiments</a><ul><li data-nav-id=/a-molecule-unfolding/b-experiments/a-environment/readme/ title="Set Up Your Envrionments" class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/a-environment/readme/>Set Up Your Envrionments</a></li><li data-nav-id=/a-molecule-unfolding/b-experiments/b-model/readme/ title="Build The Model" class="dd-item active"><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/b-model/readme/>Build The Model</a></li><li data-nav-id=/a-molecule-unfolding/b-experiments/c-optimization/readme/ title="Optimization And Analysis" class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/c-optimization/readme/>Optimization And Analysis</a></li><li data-nav-id=/a-molecule-unfolding/b-experiments/d-batch/readme/ title="Batch Experiment" class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/d-batch/readme/>Batch Experiment</a></li></ul></li><li data-nav-id=/a-molecule-unfolding/c-cleanup/ title="Clean Up" class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/c-cleanup/>Clean Up</a></li><li data-nav-id=/a-molecule-unfolding/d-reference/ title=Reference class=dd-item><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/d-reference/>Reference</a></li></ul></li></ul><section id=footer><left><a class=github-button href=https://github.com/gcr-solutions/quantum-computing-for-life-science data-icon=octicon-cloud-download aria-label="Repo of gcr-solutions/quantum-computing-for-life-science on GitHub">Repo</a>
<a class=github-button href=https://github.com/gcr-solutions/quantum-computing-for-life-science data-icon=octicon-star data-show-count=false aria-label="Star gcr-solutions/quantum-computing-for-life-science on GitHub">Star</a>
<a class=github-button href=https://github.com/gcr-solutions/quantum-computing-for-life-science/fork data-icon=octicon-repo-forked data-show-count=false aria-label="Fork gcr-solutions/quantum-computing-for-life-science on GitHub">Fork</a><p><a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | Â© 2021, Amazon Web Services, Inc. or its affiliates. All rights reserved</p></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/>Quantum Computing For Drug Discovery Workshop</a> > <a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/>Molecule Unfolding</a> > <a href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/>Experiments</a> > Build The Model</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#problem-definition>Problem Definition</a></li><li><a href=#formulation>Formulation</a></li><li><a href=#the-code-for-model>The Code for Model</a></li><li><a href=#quantum-annealing>Quantum Annealing</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Build The Model</h1><h2 id=problem-definition>Problem Definition</h2><p>In this problem, the ligand is considered as a flexible set of atoms. Strictly speaking,
it can be seen as a set of chemical bonds (edges). These bonds have fixed length and
only a subset of them are rotatable. Because there are some rotatable bonds (torsions)
, the molecule is split into different disjointed fragments. Take one bond for instance,
the rightmost rotatable one, it splits the molecule into the left and right fragments.
These fragments can rotate independently from each other around the axis of the bond. This
idea is graphically reported in the following figure.</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/rotatable-bonds.png alt="Rotatable Bonds"></p><p>As it indicates, the objective of MU is to find the shape of the ligand that can maximizes
the molecular volume. The shape of the ligand can be expressed as the unfolded shape of the
ligand (the torsion configuration of all the rotatable bonds).</p><h2 id=formulation>Formulation</h2><div class="notices warning"><p>The original paper has some work to make the story of molecular unfolding complete:</p><ol><li>elaboration of .MOL2 file for rotatable bonds</li><li>the sorting method based on the betweeness centrality</li><li>many experiments on a ligand dataset compared with Random Search and GeoDock Search</li><li>dealing with the elaboration of .MOL2 file for rotatable bonds i</li></ol><p>In this workshop, we only focus on the constructing of equation for molecule unfolding and
the application of it in quantum annealer. We make the following assumptions:</p><ol><li>The elaboration of rotatable bonds is already finished</li><li>The fragment is considered as the collections of atoms with fixed space</li><li>The geometric center of the fragment is chosen as the distances of the atoms inside</li></ol><p>For more details, please refer to the original publication.</p></div><p>Suppose the ligand has $ M $ torsions, from $ T_i $ to $ T_M $, and each torsion must have the angle
of rotation $\theta$.</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/multiple-torsion.png alt="Multiple Torsion"></p><p>The objective of this model is to find the unfolded torsion configuration $ {\Theta}^{unfold} $ which
can maximizes the sum of distances $ D(\Theta) $.</p><p>$$ {\Theta}^{unfold} = [\theta^{unfold}_1, \theta^{unfold}_2, &mldr;, \theta^{unfold}_M] $$</p><p>$$ D(\Theta) = \sum_{a,b}D_{a,b}(\theta)^2 $$</p><p>The $ D_{a,b}(\theta)^2 $ is $ || \overrightarrow{a}_0 - R(\theta)\overrightarrow{b}_0||^2 $ .
This is the distance between fragment a and b. $ R(\theta) $ is the rotation matrix associated the torsion angle
$ \theta $.</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/two-frag-one-torsion.png alt="Two Frag One Tor"></p><p>Since this is the problem of portfolio optimization, the final configuration can be the combination of any
angle of any torsion. However, there are some constraints for applying it to real problem:</p><ol><li>In terms of the limitation of computation resource, the torsion cannot have the rotation with infinitely small
precision. This means that there are limited candidates of rotation angles for each torsion. Suppose we have $ M $
torsions and they have the same precision of rotation angle : $ \Delta\theta $ . This means that we need $ d $ variables
for each torsion:</li></ol><p>$$ d = \frac{2\pi}{\Delta\theta} $$
For the whole model, we need $ n = d \times M $ binary variables $ x_{ik} $ to represent all the combinations.
For example, for the torsion $ T_i $, its torsion angle $ \theta_i $ can have $ d $ possible values:</p><p>$$ \theta_i = [\theta_i^1,\theta_i^2,\theta_i^3, &mldr;, \theta_i^d] $$</p><ol start=2><li>If we only consider the distance, the final result or configuration may have multiple results from the same torsion as long
as this combination means smaller distance. For example, there may be two binary variables of the same torsion, $ T_i $, in the
final result:</li></ol><p>$$ {\Theta}^{unfold} = [\theta^2_1, \theta^4_1, &mldr;, \theta^3_M] $$</p><p>This cannot happen in real world. $ T_1 $ can only have one of $ d $ angles finally. So we need to integrate the following constraint into our final model:</p><p>$$ \displaystyle\sum\limits_{k=1}^{d} x_{ik} = 1 $$</p><p>With these two constraints, this problem can be formulated as the high-order unconstrained binary optimization (HUBO).</p><p>$$ O(x_{ik}) = A\displaystyle\sum\limits_i (\displaystyle\sum\limits_{k=1}^d x_{ik}-1)^2 - \displaystyle\sum\limits_{a,b} D_{ab} (\theta)^2 $$</p><p>The first part is the constraint for each torsion. If one torsion has more than one angles at last, we will add the punishment term $ A $.
However, in this implementation we calculate the distance-pair under different configuration in advance. This
means that we use the absolute distance instead:</p><p>$$ O(x_{ik}) = A\displaystyle\sum\limits_i (\displaystyle\sum\limits_{k=1}^d x_{ik}-1)^2 - \displaystyle\sum\limits_{a,b} |D_{ab} (\theta)| $$</p><h2 id=the-code-for-model>The Code for Model</h2><p>We have implemented this model in <strong>protein/ligand-unfolding/ligand_unfolding.ipynb</strong>.
Suppose we have finished the parameter setting, we first initialize
the variables using the following code:</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/var-init.png alt="Var Init"></p><p>The above code indicates that we have 4 torsions from $ x_1_? to x_4_? $. Each torsion has four optional rotation angles from $ 0^o to 270^o $. For example, $ x_3_2 $ means that the torsion 3 rotates
$ 180^o $.</p><p>For constraints, we use the following code to implement:</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/constraint.png alt=Constraint></p><p>As we analyze before, the model does not which variables belong to
the same physical torsion. For example, $ x_1_1 , x_1_2, x_1_3 $
and $ x_1_4 $ belong to the same torsion. The model cannot let only
one of them become $ 1 $. If the model choose multiple of them, we
must punish it. As the figure shown, when the model choose more than
one variables of $x_1_?$ to become $ 1 $, we give it the punishment
term $ 600 $.</p><p>Most importantly, we use $ calc_distance_func $ to calculate
$ |D_{ab} (\theta)| $ under different $ \theta $.</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/distance.png alt=Distance></p><h2 id=quantum-annealing>Quantum Annealing</h2><p>The quantum annealing (QA) can be seen as a variation of the simulated annealing (SA). Both QA and SA are meta-heuristic technique for address
challenging combinatorial problems. QA uses the quantum fluctuation to explore the configuration space instead of thermal effects. Here, we use
Amazon Braket API to access the Canadian company D-Wave. This annealer is implemented using superconductive qubits. Natively, the quadratic
unconstrained binary optimization (QUBO) can be solved using quantum annealer:</p><p>$$ O(x) = \displaystyle\sum\limits_i h_i x_i + \displaystyle\sum_{i>j} J_{i,j} x_i x_j $$</p><p>In QUBO form, $ x_i \in {0, 1} $ are binary variables. We can consider it as the angle that we choose for a particular torsion. $h_i$ and $J_{i,j}$
can be considered as the values encoding the optimization task when we use corresponding angles. However, in our task, it is common that there are
more than one torsion between fragments, we model it as the high-order quadratic unconstrained binary optimization (HUBO) problem:</p><p>$$ O(x) = \displaystyle\sum\limits_i \alpha_i x_i + \displaystyle\sum_{i,j} \beta_{i,j} x_i x_j + \displaystyle\sum_{i,j,k} \gamma_{i,j,k} x_i x_j x_k + &mldr; $$</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/two-frag-multiple-torsion.png alt="Two Frag Mul Tor"></p><p>It is often possible to convert HUBOs to QUBOs by using some tricks,
like adding new ancillary binary variables to replace high-order term.
In practice, we use the API $ make _ quadratic() $ in D-Wave software package to make this conversion.</p><p><img src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/images/hubo-qubo.png alt="HUBO QUBO"></p><p>As the image shown, some high-order term of HUBO, like $ (&lsquo;x_1_1&rsquo;,&lsquo;x_2_1&rsquo;,&lsquo;x_3_1&rsquo;) $, have been
transformed to binary terms in QUBO. We only highlight some of them.</p><p>Congratulations! We have already prepared the model and it is time to test it.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/a-environment/readme/ title="Set Up Your Envrionments"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/a-molecule-unfolding/b-experiments/c-optimization/readme/ title="Optimization And Analysis" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/clipboard.min.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/perfect-scrollbar.min.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/perfect-scrollbar.jquery.min.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/jquery.sticky.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/featherlight.min.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/highlight.pack.js?1633697294></script><script>hljs.initHighlightingOnLoad();</script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/modernizr.custom-3.6.0.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/learn.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/js/hugo-learn.js?1633697294></script><script src=https://gcr-solutions.github.io/quantum-computing-for-life-science-workshop/mermaid/mermaid.js?1633697294></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>